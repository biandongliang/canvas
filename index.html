<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>双人抢金币</title>
<style>
body {
    text-align: center;
    background: #222;
    color: white;
    font-family: Arial;
}
canvas {
    background: #111;
    border: 2px solid white;
}
</style>
</head>
<body>

<h2>双人抢金币</h2>
<p>玩家1：WASD（蓝色） | 玩家2：方向键（红色）</p>
<p id="score"></p>
<canvas id="game" width="600" height="400"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreText = document.getElementById("score");

const winScore = 5;

let player1 = { x: 50, y: 200, score: 0, color: "blue" };
let player2 = { x: 550, y: 200, score: 0, color: "red" };

let coin = spawnCoin();
let gameOver = false;

function spawnCoin() {
    return {
        x: Math.random() * (canvas.width - 20),
        y: Math.random() * (canvas.height - 20)
    };
}

document.addEventListener("keydown", (e) => {
    if (gameOver) return;

    const speed = 15;

    // 玩家1 - WASD
    if (e.key === "w") player1.y -= speed;
    if (e.key === "s") player1.y += speed;
    if (e.key === "a") player1.x -= speed;
    if (e.key === "d") player1.x += speed;

    // 玩家2 - 方向键
    if (e.key === "ArrowUp") player2.y -= speed;
    if (e.key === "ArrowDown") player2.y += speed;
    if (e.key === "ArrowLeft") player2.x -= speed;
    if (e.key === "ArrowRight") player2.x += speed;

    limit(player1);
    limit(player2);

    checkCollision();
});

function limit(player) {
    player.x = Math.max(0, Math.min(canvas.width - 30, player.x));
    player.y = Math.max(0, Math.min(canvas.height - 30, player.y));
}

function checkCollision() {
    if (isColliding(player1, coin)) {
        player1.score++;
        coin = spawnCoin();
    }

    if (isColliding(player2, coin)) {
        player2.score++;
        coin = spawnCoin();
    }

    if (player1.score >= winScore) endGame("玩家1胜利！");
    if (player2.score >= winScore) endGame("玩家2胜利！");
}

function isColliding(player, coin) {
    return (
        player.x < coin.x + 20 &&
        player.x + 30 > coin.x &&
        player.y < coin.y + 20 &&
        player.y + 30 > coin.y
    );
}

function endGame(text) {
    gameOver = true;
    setTimeout(() => {
        alert(text);
        resetGame();
    }, 100);
}

function resetGame() {
    player1.score = 0;
    player2.score = 0;
    player1.x = 50;
    player2.x = 550;
    coin = spawnCoin();
    gameOver = false;
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // 画金币
    ctx.fillStyle = "gold";
    ctx.fillRect(coin.x, coin.y, 20, 20);

    // 画玩家
    ctx.fillStyle = player1.color;
    ctx.fillRect(player1.x, player1.y, 30, 30);

    ctx.fillStyle = player2.color;
    ctx.fillRect(player2.x, player2.y, 30, 30);

    scoreText.innerText = 
        `玩家1: ${player1.score} 分 | 玩家2: ${player2.score} 分`;

    requestAnimationFrame(draw);
}

draw();
</script>

</body>
</html>
